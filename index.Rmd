---
title: "SQL"
output: html_document
---

## Filtering coulumns and Rows

With SQL, you can filter columns and row by using SELECT and WHERE. Let's look at an example using the Lahman database. So we could first load that database, along with the package sqldf.

```{r message = FALSE, warning = FALSE}
library(Lahman)
library(sqldf)
```

Suppose now I would like to see the homerun totals for the 1927 Yankees. I could write the following query.

```{r}
query<-"SELECT playerID,yearID,teamID,HR FROM Batting
WHERE teamID='NYA' and yearID=1927"
sqldf(query)
```

Suppose now I would like to find all the instances where a player had more than 40 HR but less than 60 strikeouts (SO).

```{r}
query<-"SELECT playerID,yearID,teamID,HR FROM Batting
WHERE teamID='NYA' and HR>=40"
sqldf(query)
```

Suppose now I would like to find all the instances where a player had more than 40 HR but less than 60 strikeouts (SO).

```{r}
query<-"SELECT playerID,yearID,teamID,HR,SO FROM Batting
WHERE HR>40 and SO<60"
sqldf(query)
```

Suppose now I would like to find all instances of the Phillies (PHI) in the 1970's hitting more than 30 HR's.

```{r}
query<-"SELECT playerID,yearID,teamID,HR FROM Batting
WHERE teamID='PHI' and HR>30 and yearID<=1979 and yearID>=1970"
sqldf(query)
```

Suppose now I would like to find every instance of a player hitting more than 50 homeruns. Let's have the players with the highest homerun total at the top.

```{r}
query<-"SELECT playerID,yearID,teamID,HR FROM Batting
WHERE HR>50
ORDER BY HR DESC"
sqldf(query)
```

Find all instances of a player striking out less than 10 times. Make sure each player has had at least 400 at bats (AB). Order by having the least strikeouts at the top.


```{r}
query<-"SELECT playerID,yearID,teamID,SO,AB FROM Batting
WHERE SO<10 and AB>=400
ORDER BY SO"
sqldf(query)
```

Find Babe Ruth's career homerun total.


```{r}
query<-"SELECT playerID,sum(HR) FROM Batting
WHERE playerID='ruthba01'
GROUP BY playerID"
sqldf(query)
```

Find the career homerun totals for all players, but limit the output to totals of 600 or more. Order by career total.


```{r}
query<-"SELECT playerID,sum(HR) FROM Batting
GROUP BY playerID
HAVING sum(HR)>=600
ORDER BY sum(HR) DESC"
sqldf(query)
```

Find the players who have averaged more than 30 homeruns per year throughout their career. Let's order by having the highest average at the top.


```{r}
query<-"SELECT playerID,avg(HR) FROM Batting
GROUP BY playerID
HAVING avg(HR)>30
ORDER BY avg(HR) DESC"
sqldf(query)
```

Find first and last names, along with teamID, yearID, HR, and player should be Babe Ruth.

```{r}
query<-"SELECT nameFirst,nameLast,teamID,yearID,HR
FROM Batting INNER JOIN Master
ON Batting.playerID=Master.playerID
WHERE Batting.playerID='ruthba01'"
sqldf(query)
```

Find all instances of players hitting more than 50 homeruns. Include first and last names, team, year, and homeruns.

```{r}
query<-"SELECT nameFirst,nameLast,yearID,teamID,HR
FROM Batting INNER JOIN Master
ON Batting.playerID=Master.playerID
WHERE HR>50
ORDER BY HR DESC"
sqldf(query)
```

With team name displayed, find homeruns by season for Babe Ruth.

```{r}
query<-"SELECT playerID,name,Batting.yearID,Batting.HR
FROM Batting INNER JOIN Teams
ON Batting.teamID=Teams.teamID and Batting.yearID=Teams.yearID
WHERE playerID='ruthba01'"
sqldf(query)
```

